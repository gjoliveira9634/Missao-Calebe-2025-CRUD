<!DOCTYPE html>
<html
	lang="pt-BR"
	class="h-full">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0" />
		<title>Missão Calebe 2025 | IASD Recanto das Emas</title>

		<!-- TailwindCSS -->
		<script src="https://cdn.tailwindcss.com"></script>

		<!-- Alpine.js -->
		<script
			defer
			src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

		<!-- Font Awesome para ícones -->
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

		<style>
			[x-cloak] {
				display: none !important;
			}
		</style>
	</head>
	<body
		class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen"
		x-data="missionApp()"
		x-init="carregarIntegrantes()">
		<!-- Header -->
		<header class="bg-white shadow-lg border-b-4 border-blue-600">
			<div class="container mx-auto px-4 py-6">
				<div class="flex items-center justify-between">
					<div class="flex items-center space-x-4">
						<div class="bg-blue-600 p-3 rounded-full">
							<i class="fas fa-church text-white text-xl"></i>
						</div>
						<div>
							<h1 class="text-2xl font-bold text-gray-800"
								>Missão Calebe 2025</h1
							>
							<p class="text-gray-600">IASD Recanto das Emas - 12/07 a 25/07</p>
						</div>
					</div>
					<div
						class="text-right"
						x-show="estatisticas.total > 0">
						<div
							class="text-3xl font-bold text-blue-600"
							x-text="estatisticas.total"></div>
						<div class="text-sm text-gray-600">Integrantes</div>
					</div>
				</div>
			</div>
		</header>

		<main class="container mx-auto px-4 py-8">
			<div class="grid lg:grid-cols-3 gap-8">
				<!-- Formulário de Cadastro -->
				<div class="lg:col-span-1">
					<div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
						<div class="flex items-center mb-6">
							<i class="fas fa-user-plus text-blue-600 text-xl mr-3"></i>
							<h2 class="text-xl font-bold text-gray-800">Novo Integrante</h2>
						</div>

						<form
							@submit.prevent="adicionarIntegrante()"
							class="space-y-4">
							<!-- Nome -->
							<div>
								<label class="block text-sm font-medium text-gray-700 mb-2">
									<i class="fas fa-user mr-1"></i> Nome Completo
								</label>
								<input
									type="text"
									x-model="novoIntegrante.nome"
									required
									class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
									placeholder="Digite o nome completo" />
							</div>

							<!-- Igreja -->
							<div>
								<label class="block text-sm font-medium text-gray-700 mb-2">
									<i class="fas fa-church mr-1"></i> Igreja
								</label>
								<select
									x-model="novoIntegrante.igreja"
									required
									class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
									<option value="">Selecione a igreja</option>
									<option value="403">IASD Recanto das Emas 403</option>
									<option value="114">IASD Recanto das Emas 114</option>
									<option value="803">IASD Recanto das Emas 803</option>
								</select>
							</div>

							<!-- Turnos -->
							<div>
								<label class="block text-sm font-medium text-gray-700 mb-3">
									<i class="fas fa-clock mr-1"></i> Turnos Disponíveis
								</label>
								<div class="space-y-3">
									<label
										class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
										<input
											type="checkbox"
											value="matutino"
											x-model="novoIntegrante.turnos"
											class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
										<span class="ml-3 flex-1">
											<i class="fas fa-sun text-yellow-500 mr-2"></i>
											<strong>Matutino</strong> (08:00 - 12:00)
										</span>
									</label>
									<label
										class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
										<input
											type="checkbox"
											value="vespertino"
											x-model="novoIntegrante.turnos"
											class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
										<span class="ml-3 flex-1">
											<i class="fas fa-sun text-orange-500 mr-2"></i>
											<strong>Vespertino</strong> (13:00 - 17:00)
										</span>
									</label>
									<label
										class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
										<input
											type="checkbox"
											value="noturno"
											x-model="novoIntegrante.turnos"
											class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
										<span class="ml-3 flex-1">
											<i class="fas fa-moon text-purple-500 mr-2"></i>
											<strong>Noturno</strong> (18:00 - 22:00)
										</span>
									</label>
								</div>
							</div>

							<button
								type="submit"
								:disabled="loading"
								class="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center">
								<i
									class="fas fa-plus mr-2"
									x-show="!loading"></i>
								<i
									class="fas fa-spinner fa-spin mr-2"
									x-show="loading"
									x-cloak></i>
								<span
									x-text="loading ? 'Cadastrando...' : 'Cadastrar Integrante'"></span>
							</button>
						</form>
					</div>

					<!-- Estatísticas -->
					<div
						class="bg-white rounded-xl shadow-lg p-6 border border-gray-200 mt-6"
						x-show="estatisticas.total > 0">
						<h3 class="text-lg font-bold text-gray-800 mb-4">
							<i class="fas fa-chart-bar text-blue-600 mr-2"></i>
							Estatísticas
						</h3>

						<div class="space-y-4">
							<!-- Por Igreja -->
							<div>
								<h4 class="font-medium text-gray-700 mb-2">Por Igreja:</h4>
								<template
									x-for="igreja in estatisticas.porIgreja"
									:key="igreja.igreja">
									<div class="flex justify-between items-center py-1">
										<span
											class="text-sm"
											x-text="`IASD ${igreja.igreja}`"></span>
										<span
											class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm font-medium"
											x-text="igreja.quantidade"></span>
									</div>
								</template>
							</div>

							<!-- Por Turno -->
							<div>
								<h4 class="font-medium text-gray-700 mb-2">Por Turno:</h4>
								<div class="space-y-1 text-sm">
									<div class="flex justify-between">
										<span
											><i class="fas fa-sun text-yellow-500 mr-1"></i>
											Matutino</span
										>
										<span x-text="estatisticas.porTurno.matutino"></span>
									</div>
									<div class="flex justify-between">
										<span
											><i class="fas fa-sun text-orange-500 mr-1"></i>
											Vespertino</span
										>
										<span x-text="estatisticas.porTurno.vespertino"></span>
									</div>
									<div class="flex justify-between">
										<span
											><i class="fas fa-moon text-purple-500 mr-1"></i>
											Noturno</span
										>
										<span x-text="estatisticas.porTurno.noturno"></span>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Lista de Integrantes -->
				<div class="lg:col-span-2">
					<div class="bg-white rounded-xl shadow-lg border border-gray-200">
						<div class="p-6 border-b border-gray-200">
							<div class="flex items-center justify-between">
								<h2 class="text-xl font-bold text-gray-800">
									<i class="fas fa-list text-blue-600 mr-2"></i>
									Lista de Integrantes
								</h2>
								<div
									class="text-sm text-gray-600"
									x-show="integrantes.length > 0">
									<span x-text="integrantes.length"></span> integrantes
									cadastrados
								</div>
							</div>
						</div>

						<div class="p-6">
							<!-- Estado vazio -->
							<div
								x-show="integrantes.length === 0 && !loading"
								class="text-center py-12">
								<i class="fas fa-users text-gray-300 text-6xl mb-4"></i>
								<h3 class="text-lg font-medium text-gray-500 mb-2"
									>Nenhum integrante cadastrado</h3
								>
								<p class="text-gray-400"
									>Comece cadastrando o primeiro integrante da Missão Calebe!</p
								>
							</div>

							<!-- Loading -->
							<div
								x-show="loading && integrantes.length === 0"
								class="text-center py-12"
								x-cloak>
								<i
									class="fas fa-spinner fa-spin text-blue-600 text-3xl mb-4"></i>
								<p class="text-gray-600">Carregando integrantes...</p>
							</div>

							<!-- Lista -->
							<div
								x-show="integrantes.length > 0"
								class="space-y-3">
								<template
									x-for="integrante in integrantes"
									:key="integrante.id">
									<div
										class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
										<div class="flex items-center justify-between">
											<div class="flex-1">
												<div class="flex items-center mb-2">
													<h3
														class="font-semibold text-gray-800"
														x-text="integrante.nome"></h3>
													<span
														class="ml-3 bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium"
														x-text="`IASD ${integrante.igreja}`">
													</span>
												</div>

												<div class="flex items-center space-x-4 text-sm">
													<!-- Turnos -->
													<div class="flex items-center space-x-2">
														<span class="text-gray-600">Turnos:</span>

														<div class="flex items-center space-x-1">
															<i class="fas fa-sun text-yellow-500"></i>
															<i
																:class="integrante.turno_matutino ? 'fas fa-check text-green-600' : 'fas fa-times text-red-400'"></i>
														</div>

														<div class="flex items-center space-x-1">
															<i class="fas fa-sun text-orange-500"></i>
															<i
																:class="integrante.turno_vespertino ? 'fas fa-check text-green-600' : 'fas fa-times text-red-400'"></i>
														</div>

														<div class="flex items-center space-x-1">
															<i class="fas fa-moon text-purple-500"></i>
															<i
																:class="integrante.turno_noturno ? 'fas fa-check text-green-600' : 'fas fa-times text-red-400'"></i>
														</div>
													</div>
												</div>
											</div>

											<button
												@click="removerIntegrante(integrante.id)"
												class="text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-colors"
												title="Remover integrante">
												<i class="fas fa-trash"></i>
											</button>
										</div>
									</div>
								</template>
							</div>
						</div>
					</div>
				</div>
			</div>
		</main>

		<!-- Footer -->
		<footer class="bg-white border-t border-gray-200 mt-12">
			<div class="container mx-auto px-4 py-6">
				<div class="flex flex-col md:flex-row items-center justify-between">
					<div class="text-gray-600 text-sm mb-4 md:mb-0">
						<p
							>&copy; 2025 IASD Recanto das Emas - Missão Calebe. Todos os
							direitos reservados.</p
						>
					</div>
					<div class="flex items-center space-x-2 text-sm">
						<span class="text-gray-600">Desenvolvido por</span>
						<a
							href="https://gjoliveira.dev"
							target="_blank"
							rel="noopener noreferrer"
							class="text-blue-600 hover:text-blue-800 font-medium transition-colors">
							<i class="fas fa-external-link-alt mr-1"></i>
							gjoliveira.dev
						</a>
					</div>
				</div>
			</div>
		</footer>

		<!-- Toast para notificações -->
		<aside
			x-show="toast.show"
			x-transition
			class="fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg text-white max-w-sm"
			:class="toast.type === 'success' ? 'bg-green-600' : 'bg-red-600'"
			x-cloak>
			<div class="flex items-center">
				<i
					:class="toast.type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle'"
					class="mr-2"></i>
				<span x-text="toast.message"></span>
			</div>
		</aside>

		<script>
			function missionApp() {
				return {
					integrantes: [],
					estatisticas: {
						total: 0,
						porIgreja: [],
						porTurno: { matutino: 0, vespertino: 0, noturno: 0 },
					},
					novoIntegrante: {
						nome: "",
						igreja: "",
						turnos: [],
					},
					loading: false,
					toast: {
						show: false,
						message: "",
						type: "success",
					},

					async carregarIntegrantes() {
						try {
							this.loading = true;
							const response = await fetch("/api/integrantes");
							this.integrantes = await response.json();
							await this.carregarEstatisticas();
						} catch (error) {
							this.mostrarToast("Erro ao carregar integrantes", "error");
							console.error("Erro:", error);
						} finally {
							this.loading = false;
						}
					},

					async carregarEstatisticas() {
						try {
							const response = await fetch("/api/estatisticas");
							this.estatisticas = await response.json();
						} catch (error) {
							console.error("Erro ao carregar estatísticas:", error);
						}
					},

					async adicionarIntegrante() {
						if (!this.novoIntegrante.nome.trim()) {
							this.mostrarToast("Por favor, digite o nome", "error");
							return;
						}

						if (!this.novoIntegrante.igreja) {
							this.mostrarToast("Por favor, selecione a igreja", "error");
							return;
						}

						if (this.novoIntegrante.turnos.length === 0) {
							this.mostrarToast(
								"Por favor, selecione pelo menos um turno",
								"error",
							);
							return;
						}

						try {
							this.loading = true;
							const response = await fetch("/api/integrantes", {
								method: "POST",
								headers: {
									"Content-Type": "application/json",
								},
								body: JSON.stringify(this.novoIntegrante),
							});

							if (response.ok) {
								this.mostrarToast(
									"Integrante cadastrado com sucesso! 🎉",
									"success",
								);
								this.resetarFormulario();
								await this.carregarIntegrantes();
							} else {
								const error = await response.json();
								this.mostrarToast(error.error || "Erro ao cadastrar", "error");
							}
						} catch (error) {
							this.mostrarToast("Erro de conexão", "error");
							console.error("Erro:", error);
						} finally {
							this.loading = false;
						}
					},

					async removerIntegrante(id) {
						if (!confirm("Tem certeza que deseja remover este integrante?")) {
							return;
						}

						try {
							const response = await fetch(`/api/integrantes/${id}`, {
								method: "DELETE",
							});

							if (response.ok) {
								this.mostrarToast("Integrante removido com sucesso", "success");
								await this.carregarIntegrantes();
							} else {
								this.mostrarToast("Erro ao remover integrante", "error");
							}
						} catch (error) {
							this.mostrarToast("Erro de conexão", "error");
							console.error("Erro:", error);
						}
					},

					resetarFormulario() {
						this.novoIntegrante = {
							nome: "",
							igreja: "",
							turnos: [],
						};
					},

					mostrarToast(message, type = "success") {
						this.toast = { show: true, message, type };
						setTimeout(() => {
							this.toast.show = false;
						}, 4000);
					},
				};
			}
		</script>
	</body>
</html>
